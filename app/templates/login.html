{% extends "base.html" %}

{% block title %}Login - PotatoMail{% endblock %}

{% block content %}
<div class="auth-container" x-data="loginForm()">
    <div class="auth-card">
        <h1>Login</h1>
        
        <div x-show="error" class="alert alert-error" x-cloak>
            <span x-text="error"></span>
        </div>

        <form @submit.prevent="handleLogin">
            <div class="form-group">
                <label for="email">Email</label>
                <input 
                    type="email" 
                    id="email" 
                    x-model="email" 
                    required
                    placeholder="your@email.com"
                />
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input 
                    type="password" 
                    id="password" 
                    x-model="password" 
                    required
                    placeholder="••••••••"
                />
            </div>

            <button type="submit" class="btn btn-primary" :disabled="loading">
                <span x-show="!loading">Login</span>
                <span x-show="loading">Logging in...</span>
            </button>
        </form>

        <p class="auth-link">
            Don't have an account? <a href="{{ url_for('auth.register') }}">Register here</a>
        </p>
    </div>
</div>

<script>
    function loginForm() {
        return {
            email: '',
            password: '',
            error: '',
            loading: false,

            async handleLogin() {
                this.error = '';
                this.loading = true;

                try {
                    const response = await fetch('{{ url_for("auth.login") }}', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: this.email,
                            password: this.password
                        })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        this.error = data.error || 'Login failed';
                        this.loading = false;
                        return;
                    }

                    window.location.href = data.redirect;
                } catch (err) {
                    this.error = 'Network error. Please try again.';
                    this.loading = false;
                }
            }
        }
    }
</script>
{% endblock %}
